<!DOCTYPE html>
<html lang="ja">
  <head>
  <meta charset="UTF-8">
  <title>ã‚ãªãŸã®YouTubeã®é–²è¦§å±¥æ­´ã‹ã‚‰ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«ã‚’å®Ÿæ„Ÿã—ã‚ˆã†</title>
ã€€ <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru&display=swap" rel="stylesheet">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <style>
    body {
     font-family: 'Kiwi Maru', serif; 
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start; /* ä¸Šéƒ¨ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å¯„ã›ã‚‹ */
      height: auto; /* é«˜ã•ã‚’è‡ªå‹•èª¿æ•´ */
      background-color: #F0F2FF; /* èƒŒæ™¯è‰²ã‚’ #F0F2FF ã«è¨­å®š */
      color: #000; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
      overflow: auto; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹ */
      position: relative;
      padding-top: 50px; /* ä¸Šéƒ¨ã«ä½™ç™½ã‚’è¿½åŠ  */
      letter-spacing: 2px;
    }
  
  
#main-title {
  position: relative;
  padding: 1rem .5rem;
  font-size: 43px; /* å¿…è¦ã«å¿œã˜ã¦èª¿æ•´ */
  font-weight: bold;
  color: #000; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
  background-color: #6ADDED; /* èƒŒæ™¯è‰²ã‚’ #6ABBC6 ã«è¨­å®š */
  padding: 25px; /* ä½™ç™½ã‚’å¤§ãã */
  border-radius: 10px; /* è§’ã‚’ä¸¸ã */
  width: 50%; /* ã‚¿ã‚¤ãƒˆãƒ«ã®å¹…ã‚’èª¿æ•´ */
  text-align: center; /* ä¸­å¤®æƒãˆ */
  margin-bottom: 40px; /* ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒœã‚¿ãƒ³ã®é–“ã«ä½™ç™½ã‚’è¿½åŠ  */
  line-height: 1.5; /* è¡Œé–“ã‚’èª¿æ•´ã—ã¦2è¡Œã«è¦‹ã‚„ã™ãã™ã‚‹ */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  border: 2px solid #000;
}
#main-title:after {
  position: absolute;
  bottom: 0px; /* ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸‹ã«é…ç½® */
  left: 0;
  width: 100%;
  height: 10px; /* ä¸‹ç·šã®å¤ªã• */
  content: '';
  border-radius: 3px;
  background-image: -webkit-gradient(linear, right top, left top, from(#2af598), to(#009efd));
  background-image: -webkit-linear-gradient(right, #2af598 0%, #009efd 100%);
  background-image: linear-gradient(to left, #2af598 0%, #009efd 100%);
    border-top: 2px solid #000;
  background-image: -webkit-repeating-linear-gradient(135deg, #000, #000 1px, transparent 2px, transparent 5px);
  background-image: repeating-linear-gradient(-45deg, #000, #000 1px, transparent 2px, transparent 5px);
  background-size: 7px 7px;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}


h2 {
  position: relative;
  overflow: hidden;
  padding: 1.5rem 2rem 1.5rem 130px;
  word-break: break-all;
  border-top: 3px solid #000;
  border-radius: 12px 0 0 0;
}

h2 span {
  font-size: 40px;
  font-size: 4rem;
  position: absolute;
  top: 0;
  left: 0;
  display: block;
  padding: 3px 20px;
  color: #fff;
  border-radius: 10px 0 20px 10px;
  background: #000;
}

    
    .content-box {
  background-color: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  max-width: 800px;
  margin: 20px auto;
}

.content-box h2 {
  font-size: 1.5em;
  margin-bottom: 45px;
  margin-top: 40px; 
  text-align: center;
   position: relative;
   padding: 1.5rem;
}

.content-box h2:before {
  position: absolute;
  bottom: -10px;
  left: calc(50% - 30px);
  width: 60px;
  height: 5px;
  content: '';
  border-radius: 3px;
  background: #F1454B;
}

.content-box h2:after {
  position: absolute;
  content: '';
}


.content-box h2:after {
  top: 0;
  left: 0;
  width: 40px;
  height: 40px;
  border-top: 2px solid #000;
  border-left: 2px solid #000;
}

.content-box p {
  line-height: 1.6;
  font-size: 1.3em;
  margin-bottom: 10px;
}
    
.highlight {
  font-weight: bold;
  color: red;
}

.littlehighlight {
  font-weight: bold;
}


    
    #instruction {
    font-size: 30px; /* å…ƒã®16pxã‹ã‚‰1.5å€ */
    font-weight: bold;
    color: #000; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
    background-color: #FFFFFF;
    padding: 22.5px; /* å…ƒã®15pxã‹ã‚‰1.5å€ */
    border-radius: 15px; /* å…ƒã®10pxã‹ã‚‰1.5å€ */
    border: 4.5px solid #6e7dff; /* å…ƒã®2pxã‹ã‚‰1.5å€ */
    text-align: center;
    margin: 30px 0; /* å…ƒã®20pxã‹ã‚‰1.5å€ */
    line-height: 2.25; /* å…ƒã®1.5ã‹ã‚‰1.5å€ */
    width: 50%;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* å…ƒã®å½±ã‚’1.5å€ */
  }

    /* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    h1 {
      font-size: 30px;
      color: #000; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
      margin-bottom: 45px; /* ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒœã‚¿ãƒ³ã®é–“ã«å¤§ããªä½™ç™½ */
    }
  
    #load-file {
      padding: 15px 30px;
      font-size: 24px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      background-color: #6e7dff;
      border: none;
      color: #fff; /* ãƒœã‚¿ãƒ³å†…ã®æ–‡å­—è‰²ã¯ç™½ã®ã¾ã¾ */
      border-radius: 7.5px;
      margin-bottom: 45px; /* ãƒœã‚¿ãƒ³ã¨ç”»åƒã®é–“ã«ä½™ç™½ã‚’è¿½åŠ  */
    }
  
    #load-file:hover {
      background-color: #4d5bc5;
    }
  
    #container {
      width: 90%;
      max-width: 1200px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
#bubble-animation {
  width: 700px; 
  height: auto;
  margin-bottom: 40px; 
  display: none; /* å¿…è¦ã«å¿œã˜ã¦blockã«å¤‰æ›´ */
  position: relative; /* bubble-animationã«ã‚‚positionã‚’è¨­å®š */
  z-index: 1; /* bubble-animationã¯z-index: 1 */
}

@keyframes floatUpDown {
  0% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-5px); /* ä¸Šã«ãµã‚ã£ã¨ */
  }
  100% {
    transform: translateY(0);
  }
}

.floating {
  animation: floatUpDown 2s ease-in-out infinite;
}


    
    /* å††ã‚°ãƒ©ãƒ•ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #pie-chart {
      width: 800px;
      height: 800px;
      border: 3px solid #ddd;
      border-radius: 15px;
      background-color: #f9f9f9;
      padding: 30px;
      position: relative;
      z-index: 1; /* ç”»åƒã®ä¸‹ã«é…ç½® */
    }

   
/* ã‚¹ãƒãƒ›ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
@media screen and (max-width: 1300px) {
  body {
    font-size: calc(1.3 * 16px); /* å…ƒã®åŸºæœ¬ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’1.3å€ */
  }

  #main-title,
  #instruction,
   #pie-chart{
    width: calc(1.5 * 60%); /* å…ƒã®å¹…ã‚’1.5å€ */
  }

    .content-box {
    max-width: 70%; /* ã‚¹ãƒãƒ›ç”¨ã®æœ€å¤§å¹… */
    padding: 24px; 
  }

  #load-file {
    font-size: calc(1.3 * 24px); /* ãƒœã‚¿ãƒ³æ–‡å­—ã‚µã‚¤ã‚º */
    padding: calc(1.5 * 15px) calc(1.5 * 30px); /* ãƒœã‚¿ãƒ³ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° */
  }


  #bubble-animation,
  #top-images img {
    width: calc(1.3 * 700px); /* Bubble Animationã®å¹…ã‚’1.3å€ */
  }
}

  </style>  
</head>
<body>
  <div id="main-title">
    YouTubeã®é–²è¦§å±¥æ­´ã‹ã‚‰<br>ã‚ãªãŸã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«ã«æ°—ä»˜ã“ã†
  </div>
  
<h2><span>01</span>ã¯ã˜ã‚ã«</h2>
  
  <div class="content-box">
  <h2>ã‚ãªãŸã®YouTubeã€åã£ãŸå‹•ç”»ã°ã‹ã‚Šã§ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ</h2>
  <p>YouTubeã‚’åˆ©ç”¨ã™ã‚‹ã¨ãã€<br>
ã€Œã„ã¤ã‚‚åŒã˜ã‚¸ãƒ£ãƒ³ãƒ«ã®å‹•ç”»ã°ã‹ã‚ŠãŒãŠã™ã™ã‚ã•ã‚Œã‚‹ã€<br>
ãã†æ„Ÿã˜ãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ<br><br>
YouTubeã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã€ã‚ãªãŸã®éå»ã®è¦–è´å±¥æ­´ã‚„æ¤œç´¢å±¥æ­´ã‹ã‚‰ã€<br>
<span class="highlight">ã€Œã‚ãªãŸãŒè¦‹ãŸã„ã¨æ€ã†å‹•ç”»ã€ã‚’äºˆæ¸¬ã—ã¦</span>è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚<br><br>

ã“ã‚Œã¯ä¾¿åˆ©ãªåé¢ã€ã¾ã‚‹ã§å¥½ããªé£Ÿã¹ç‰©ã‚’ã„ã¤ã‚‚é ¼ã‚€ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã§ã€<br>
æ–°ã—ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å‹§ã‚ã‚‰ã‚Œãªã„ã‚ˆã†ãªçŠ¶æ…‹ã«ãªã‚ŠãŒã¡ã§ã™ã€‚</p>

  <h2>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«ã¨ã¯ï¼Ÿ</h2>
  <p>
ã“ã®ã‚ˆã†ãªç¾è±¡ã‚’ã€Œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«ã€ã¨å‘¼ã³ã¾ã™ã€‚<br>
ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«ã®å•é¡Œç‚¹ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š<br><br>

ãƒ» <span class="highlight">å¤šæ§˜ãªæ„è¦‹ã‚„æ–°ã—ã„è¦–ç‚¹ã«è§¦ã‚Œã‚‹æ©Ÿä¼šã‚’å¥ªã†</span><br>
ãƒ» åã£ãŸæƒ…å ±ã«å›²ã¾ã‚Œã¦ã—ã¾ã†<br><br>
YouTubeã®ãŠã™ã™ã‚æ©Ÿèƒ½ã¯ã¨ã¦ã‚‚ä¾¿åˆ©ãªã‚‚ã®ã§ã™ãŒã€<br>
åŒæ™‚ã«çŸ¥ã‚‰ãªã„ä¸–ç•Œã¸ã®æ‰‰ã‚’é–‰ã–ã—ã¦ã—ã¾ã†å¯èƒ½æ€§ã‚‚ç§˜ã‚ã¦ã„ã¾ã™ã€‚</p>

  <h2>ã“ã®ã‚µã‚¤ãƒˆã§ã€Œãƒãƒ–ãƒ«ã€ã‚’ç ´ã‚ã†ï¼</h2>
  <p>ãã“ã§ã€æœ¬ã‚µã‚¤ãƒˆã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€<br>
ã‚ãªãŸãŒã€Œã©ã‚“ãªã‚¸ãƒ£ãƒ³ãƒ«ãŒå¥½ãã‹ã€<br>
ã€Œã©ã‚“ãªã‚¸ãƒ£ãƒ³ãƒ«ã«ã‚ã¾ã‚Šèˆˆå‘³ãŒãªã„ã‹ã€<br>
ã¨ã„ã†è‡ªèº«ã®è¶£å‘³å—œå¥½ã‚’ä¸€ç›®ã§ç†è§£ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚

</p>

  <h2>ã€Œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«ã€ã‚’ç ´ã‚‹ãƒ¡ãƒªãƒƒãƒˆ</h2>
  <p>ã“ã‚Œã‚’ãã£ã‹ã‘ã«æ–°ã—ã„ã‚¸ãƒ£ãƒ³ãƒ«ã®å‹•ç”»ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€<br>
    æ¬¡ç¬¬ã«ã‚ãªãŸã®ã€Œãƒãƒ–ãƒ«ã€ã¯å‰²ã‚Œã¦ã„ãã§ã—ã‚‡ã†ã€‚<br><br>
    è¦‹èã‚’åºƒã‚ã‚‹ã“ã¨ã¯ã€ã‚ãªãŸã®ç”Ÿæ´»ã‚’è±Šã‹ã«ã™ã‚‹è‚¥æ–™ã«ãªã‚Šã¾ã™ã€‚<br>
    <span class="littlehighlight">ãœã²ã€è‡ªèº«ã®YouTubeã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«ã«æ°—ä»˜ãã“ã¨ã§ã€<br>
    æ¯æ—¥æ–°ã—ã„å‡ºä¼šã„ã«æº¢ã‚Œã‚‹äººç”Ÿã®ç¨®ã‚’è‚²ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚</span>


</p>
</div>
  
  <div id="instruction">
    <p>
      <strong>ğŸ”´å§‹ã‚ã‚‹å‰ã«ï¼š</strong>
      <a href="https://takeout.google.com/" target="_blank" style="color: #6e7dff; text-decoration: underline;">
        https://takeout.google.com/
      </a>
      ã‹ã‚‰YouTubeã®é–²è¦§å±¥æ­´ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚
    </p>
  </div>
  <h1>ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚‚ã†</h1>
  <button id="load-file">Load ZIP File</button>
  
  <div id="container">
    <img id="bubble-animation" src="assets/images/bubble1.png" alt="Bubble Image">
    <div id="pie-chart">Loading...</div>
  </div>
  
  <footer style="background-color: #333; color: white; padding: 20px; text-align: center; font-size: 19px; line-height: 1.5;">
    <p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®YouTubeã®è¦–è´å±¥æ­´ã‚’åŸºã«ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’åˆ†æã—ã€<br>ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«(ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®åã‚Š)ã«æ°—ã¥ãã€å•é¡Œè§£æ±ºã«å½¹ç«‹ã¦ã¦ã‚‚ã‚‰ã†ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚<br>èª­ã¿è¾¼ã¾ã‚ŒãŸé–²è¦§å±¥æ­´ã®ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã€æˆ‘ã€…ã«ãã®æƒ…å ±ãŒä¸€åˆ‡å–å¾—ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã€è±Šä¸­é«˜æ ¡ æƒ…å ±5ç­ã€‘</p>
  </footer>
  
</body>
<script>
const MAX_VIDEO_COUNT = 100;
const API_KEY = 'AIzaSyCI1znNIR2N-Q8HxsXwpYV76G5Jmg1mnPE'; // APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®š
const VIDEO_API_URL = 'https://www.googleapis.com/youtube/v3/videos';

const CATEGORY_ID_MAP = {
  '1': 'æ˜ ç”»ã¨ã‚¢ãƒ‹ãƒ¡',
  '2': 'è‡ªå‹•è»Šã¨ä¹—ã‚Šç‰©',
  '10': 'éŸ³æ¥½',
  '15': 'ãƒšãƒƒãƒˆã¨å‹•ç‰©',
  '17': 'ã‚¹ãƒãƒ¼ãƒ„',
  '19': 'æ—…è¡Œã¨ã‚¤ãƒ™ãƒ³ãƒˆ',
  '20': 'ã‚²ãƒ¼ãƒ ',
  '22': 'ãƒ–ãƒ­ã‚°',
  '23': 'ã‚³ãƒ¡ãƒ‡ã‚£ãƒ¼',
  '24': 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆ',
  '25': 'ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ”¿æ²»',
  '26': 'ãƒã‚¦ãƒ„ãƒ¼ã¨ã‚¹ã‚¿ã‚¤ãƒ«',
  '27': 'æ•™è‚²',
  '28': 'ç§‘å­¦ã¨æŠ€è¡“',
};
  
  document.addEventListener('DOMContentLoaded', () => {
    const images = [
      "assets/images/bubble4.png",
      "assets/images/bubble5.png",
      "assets/images/bubble6.png"
    ];
    const imageElement = document.getElementById('bubble-animation');
    let currentIndex = 0;

    // ç”»åƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–“éš” (ãƒŸãƒªç§’)
    const interval = 500; // 0.5ç§’ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆ

    // ç”»åƒã®åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯
    setInterval(() => {
      currentIndex = (currentIndex + 1) % images.length; // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å¾ªç’°
      imageElement.src = images[currentIndex]; // ç”»åƒã‚’å¤‰æ›´
    }, interval);
  });

document.addEventListener('DOMContentLoaded', () => {
  const loadFileButton = document.getElementById('load-file');
  loadFileButton.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.zip';
    input.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          const zipData = reader.result;
          processZipFile(zipData);
        };
        reader.readAsArrayBuffer(file);
      } else {
        console.log('No file selected.');
      }
    });
    input.click();
  });
});

function processZipFile(zipData) {
  JSZip.loadAsync(zipData).then(zip => {
    // ZIPå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆåŒ–ã—ã¦ãƒ‘ã‚¹ã‚’ç¢ºèª
    zip.forEach((relativePath, file) => {
      console.log(relativePath); // ZIPå†…ã®ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è¡¨ç¤º
    });

    // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãªã—ã§å…ƒã®ãƒ‘ã‚¹ã‚’ä½¿ç”¨
    const historyFilePath = "Takeout/YouTube ã¨ YouTube Music/å±¥æ­´/watch-history.json";

    // ZIPå†…ã§æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
    const historyFile = zip.file(historyFilePath);

    if (historyFile) {
      // ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€ãã®å†…å®¹ã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦èª­ã¿è¾¼ã‚€
      historyFile.async("text").then(content => {
        parseAndDisplayHistory(content);  // é–¢æ•°ã‚’ä½¿ã£ã¦å†…å®¹ã‚’å‡¦ç†
      });
    } else {
      // ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      console.error('æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒZIPå†…ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
      alert('ZIPãƒ•ã‚¡ã‚¤ãƒ«ã«watch-history.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
    }
  }).catch(error => {
    console.error('ZIPãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
  });
}


async function fetchCategoryName(categoryId) {
  return CATEGORY_ID_MAP[categoryId] || 'ä¸æ˜ãªã‚«ãƒ†ã‚´ãƒª';
}

async function fetchVideoCategory(videoId) {
  try {
    const response = await fetch(`${VIDEO_API_URL}?part=snippet&id=${videoId}&key=${API_KEY}`);
    if (!response.ok) {
      throw new Error(`HTTPã‚¨ãƒ©ãƒ¼ï¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}`);
    }
    const data = await response.json();
    if (data.items && data.items.length > 0) {
      const categoryId = data.items[0].snippet.categoryId;
      return await fetchCategoryName(categoryId);
    }
    return 'ä¸æ˜ãªã‚«ãƒ†ã‚´ãƒª';
  } catch (error) {
    console.error('YouTube APIã®ã‚¨ãƒ©ãƒ¼:', error);
    return 'ä¸æ˜ãªã‚«ãƒ†ã‚´ãƒª';
  }
}

async function parseAndDisplayHistory(jsonText) {
  try {
    const history = JSON.parse(jsonText);
    if (!Array.isArray(history)) {
      throw new Error('ç„¡åŠ¹ãªJSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ');
    }

    const categoryCount = {};

    // ã“ã“ã§æœ€å¤§ MAX_VIDEO_COUNT ä»¶ã®å±¥æ­´ã‚’å–å¾—
    const videoUrls = history
      .filter(entry => entry.titleUrl && entry.titleUrl.startsWith('https://www.youtube.com/watch?v='))
      .slice(0, MAX_VIDEO_COUNT);

    for (const entry of videoUrls) {
      const videoId = new URL(entry.titleUrl).searchParams.get('v');
      if (videoId) {
        const categoryName = await fetchVideoCategory(videoId);
        categoryCount[categoryName] = (categoryCount[categoryName] || 0) + 1;
      }
    }

    drawPieChart(categoryCount);

  } catch (error) {
    console.error('å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®è§£æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
    const pieChartContainer = document.getElementById('pie-chart');
    pieChartContainer.innerHTML = `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`;
  }
}
const CATEGORY_IMAGES = {
  'æ˜ ç”»ã¨ã‚¢ãƒ‹ãƒ¡': 'category1.png',
  'è‡ªè»¢è»Šã¨ä¹—ã‚Šç‰©': 'category2.png',
  'éŸ³æ¥½': 'category3.png',
  'ãƒšãƒƒãƒˆã¨å‹•ç‰©': 'category4.png',
  'ã‚¹ãƒãƒ¼ãƒ„': 'category5.png',
  'æ—…è¡Œã¨ã‚¤ãƒ™ãƒ³ãƒˆ': 'category6.png',
  'ã‚²ãƒ¼ãƒ ': 'category7.png',
  'ãƒ–ãƒ­ã‚°': 'category8.png',
  'ã‚³ãƒ¡ãƒ‡ã‚£ãƒ¼': 'category9.png',
  'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆ': 'category10.png',
  'ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ”¿æ²»': 'category11.png',
  'ãƒã‚¦ãƒ„ãƒ¼ã¨ã‚¹ã‚¿ã‚¤ãƒ«': 'category12.png',
  'æ•™è‚²': 'category13.png',
  'ç§‘å­¦ã¨æŠ€è¡“': 'category14.png',
};

function drawPieChart(categoryCount) {
  google.charts.load('current', { packages: ['corechart'] });
  google.charts.setOnLoadCallback(() => {
    const data = new google.visualization.DataTable();
    data.addColumn('string', 'ã‚«ãƒ†ã‚´ãƒª');
    data.addColumn('number', 'æ•°');

    for (const [category, count] of Object.entries(categoryCount)) {
      data.addRow([category, count]);
    }

    const options = {
      title: 'ã‚ãªãŸã®è¦‹ã¦ã„ã‚‹å‹•ç”»ã‚«ãƒ†ã‚´ãƒªã®åã‚Šã¯ï¼Ÿ',
      pieHole: 0.4,
      legend: { position: 'bottom' },
    };

    const chart = new google.visualization.PieChart(document.getElementById('pie-chart'));
    chart.draw(data, options);

    // å††ã‚°ãƒ©ãƒ•ãŒæç”»ã•ã‚ŒãŸå¾Œã«ç”»åƒã‚’è¡¨ç¤º
    displayCategoryImages(categoryCount);
    document.getElementById('bubble-animation').style.display = 'block';
    document.getElementById('pie-chart').style.display = 'block'; // å††ã‚°ãƒ©ãƒ•ã®è¡¨ç¤ºã‚’ç¢ºå®Ÿã«ã™ã‚‹
  });
}

function displayCategoryImages(categoryCount) {
  const sortedCategories = Object.entries(categoryCount).sort((a, b) => b[1] - a[1]);

   const topImagesContainer = document.createElement('div');
  topImagesContainer.style.position = 'absolute';
  topImagesContainer.style.display = 'flex';
  topImagesContainer.style.justifyContent = 'center';
  topImagesContainer.style.alignItems = 'center';
  topImagesContainer.style.zIndex = '2';

  // ã‚¹ãƒãƒ›ã‹ã©ã†ã‹ã‚’åˆ¤å®š
  const isMobile = window.innerWidth <= 1300;

  if (isMobile) {
    // ã‚¹ãƒãƒ›ã®å ´åˆã®ä½ç½®è¨­å®š
    topImagesContainer.style.top = '65%';
    topImagesContainer.style.left = '42%';
    topImagesContainer.style.transform = 'translate(0%, 0%)';
  } else {
    // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®å ´åˆã®ä½ç½®è¨­å®š
    topImagesContainer.style.top = '41%';
    topImagesContainer.style.left = '45.5%';
    topImagesContainer.style.transform = 'translate(0%, 0%)';
  }
  

    const positions = isMobile
    ? [
        { top: '160px', left: '-60px' },
        { top: '-150px', left: '0px' },
        { top: '40px', left: '130px' },
      ]
    : [
        { top: '100px', left: '-90px' },
        { top: '-120px', left: '0px' },
        { top: '20px', left: '130px' },
      ];

  const squarePositions = isMobile
    ? [
        { top: '-210px', left: '-230px' },
        { top: '-210px', left: '230px' },
        { top: '300px', left: '-220px' },
        { top: '300px', left: '220px' },
      ]
    : [
        { top: '-210px', left: '-230px' },
        { top: '-210px', left: '230px' },
        { top: '250px', left: '-220px' },
        { top: '250px', left: '220px' },
      ];

  sortedCategories.slice(0, 3).forEach(([category, count], index) => {
    const imgElement = document.createElement('img');
    imgElement.src = `assets/images/${CATEGORY_IMAGES[category]}`;
    imgElement.alt = `${category}ã®ç”»åƒ`;
    imgElement.style.position = 'absolute';
    imgElement.style.top = positions[index].top;
    imgElement.style.left = positions[index].left;
    imgElement.style.width = '140px';
    imgElement.style.height = 'auto';
    imgElement.style.margin = '0 15px';
    imgElement.title = `${category} (${count}ä»¶)`;

    // ãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶ã‚’è¿½åŠ 
    const randomDelay = Math.random() * 2;  // 0ã€œ2ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶
    imgElement.style.animationDelay = `${randomDelay}s`;
    imgElement.classList.add('floating');  // CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 

    topImagesContainer.appendChild(imgElement);
  });

  sortedCategories.slice(4, 8).forEach(([category, count], index) => {
    const imgElement = document.createElement('img');
    imgElement.src = `assets/images/${CATEGORY_IMAGES[category]}`;
    imgElement.alt = `${category}ã®ç”»åƒ`;
    imgElement.style.position = 'absolute';
    imgElement.style.top = squarePositions[index].top;
    imgElement.style.left = squarePositions[index].left;
    imgElement.style.width = '140px';
    imgElement.style.height = 'auto';
    imgElement.style.margin = '0 15px';
    imgElement.title = `${category} (${count}ä»¶)`;

    // ãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶ã‚’è¿½åŠ 
    const randomDelay = Math.random() * 2;  // 0ã€œ2ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶
    imgElement.style.animationDelay = `${randomDelay}s`;
    imgElement.classList.add('floating');  // CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 

    topImagesContainer.appendChild(imgElement);
  });

  const existingContainer = document.getElementById('top-images');
  if (existingContainer) {
    existingContainer.remove();
  }
  topImagesContainer.id = 'top-images';
  document.getElementById('container').appendChild(topImagesContainer);
}

  
</script>
</html>

