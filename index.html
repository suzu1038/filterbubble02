<!DOCTYPE html>
<html lang="ja">
  <head>
  <meta charset="UTF-8">
  <title>ã‚ãªãŸã®YouTubeã®é–²è¦§å±¥æ­´ã‹ã‚‰ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«ã‚’å®Ÿæ„Ÿã—ã‚ˆã†</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start; /* ä¸Šéƒ¨ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å¯„ã›ã‚‹ */
      height: auto; /* é«˜ã•ã‚’è‡ªå‹•èª¿æ•´ */
      background-color: #F0F2FF; /* èƒŒæ™¯è‰²ã‚’ #F0F2FF ã«è¨­å®š */
      color: #000; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
      overflow: auto; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹ */
      position: relative;
      padding-top: 50px; /* ä¸Šéƒ¨ã«ä½™ç™½ã‚’è¿½åŠ  */
      letter-spacing: 2px;
    }
  
  
#main-title {
  position: relative;
  padding: 1rem .5rem;
  font-size: 43px; /* å¿…è¦ã«å¿œã˜ã¦èª¿æ•´ */
  font-weight: bold;
  color: #000; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
  background-color: #6ABBC6; /* èƒŒæ™¯è‰²ã‚’ #6ABBC6 ã«è¨­å®š */
  padding: 25px; /* ä½™ç™½ã‚’å¤§ãã */
  border-radius: 10px; /* è§’ã‚’ä¸¸ã */
  width: 50%; /* ã‚¿ã‚¤ãƒˆãƒ«ã®å¹…ã‚’èª¿æ•´ */
  text-align: center; /* ä¸­å¤®æƒãˆ */
  margin-bottom: 40px; /* ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒœã‚¿ãƒ³ã®é–“ã«ä½™ç™½ã‚’è¿½åŠ  */
  line-height: 1.5; /* è¡Œé–“ã‚’èª¿æ•´ã—ã¦2è¡Œã«è¦‹ã‚„ã™ãã™ã‚‹ */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}
#main-title:after {
  position: absolute;
  bottom: 0px; /* ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸‹ã«é…ç½® */
  left: 0;
  width: 100%;
  height: 10px; /* ä¸‹ç·šã®å¤ªã• */
  content: '';
  border-radius: 3px;
  background-image: -webkit-gradient(linear, right top, left top, from(#2af598), to(#009efd));
  background-image: -webkit-linear-gradient(right, #2af598 0%, #009efd 100%);
  background-image: linear-gradient(to left, #2af598 0%, #009efd 100%);
}

    #instruction {
    font-size: 30px; /* å…ƒã®16pxã‹ã‚‰1.5å€ */
    font-weight: bold;
    color: #000; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
    background-color: #FFFFFF;
    padding: 22.5px; /* å…ƒã®15pxã‹ã‚‰1.5å€ */
    border-radius: 15px; /* å…ƒã®10pxã‹ã‚‰1.5å€ */
    border: 4.5px solid #6e7dff; /* å…ƒã®2pxã‹ã‚‰1.5å€ */
    text-align: center;
    margin: 30px 0; /* å…ƒã®20pxã‹ã‚‰1.5å€ */
    line-height: 2.25; /* å…ƒã®1.5ã‹ã‚‰1.5å€ */
    width: 50%;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* å…ƒã®å½±ã‚’1.5å€ */
  }

    /* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    h1 {
      font-size: 30px;
      color: #000; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
      margin-bottom: 45px; /* ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒœã‚¿ãƒ³ã®é–“ã«å¤§ããªä½™ç™½ */
    }
  
    #load-file {
      padding: 15px 30px;
      font-size: 24px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      background-color: #6e7dff;
      border: none;
      color: #fff; /* ãƒœã‚¿ãƒ³å†…ã®æ–‡å­—è‰²ã¯ç™½ã®ã¾ã¾ */
      border-radius: 7.5px;
      margin-bottom: 45px; /* ãƒœã‚¿ãƒ³ã¨ç”»åƒã®é–“ã«ä½™ç™½ã‚’è¿½åŠ  */
    }
  
    #load-file:hover {
      background-color: #4d5bc5;
    }
  
    #container {
      width: 90%;
      max-width: 1200px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
#bubble-animation {
  width: 700px; 
  height: auto;
  margin-bottom: 40px; 
  display: none; /* å¿…è¦ã«å¿œã˜ã¦blockã«å¤‰æ›´ */
  position: relative; /* bubble-animationã«ã‚‚positionã‚’è¨­å®š */
  z-index: 1; /* bubble-animationã¯z-index: 1 */
}
    
#image-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  justify-content: center; /* ä¸­å¤®æƒãˆ */
  z-index: 2;
}

.category-image {
  position: absolute; /* ã™ã¹ã¦ã®ç”»åƒã‚’åŒã˜ä½ç½®ã«é‡ã­ã‚‹ */
  top: 0;
  left: 0;
}
.category-image.rank-1 {
  top: 30%; /* 1ä½ã®å ´åˆã®ä½ç½® */
}

    /* å††ã‚°ãƒ©ãƒ•ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #pie-chart {
      width: 800px;
      height: 800px;
      border: 3px solid #ddd;
      border-radius: 15px;
      background-color: #f9f9f9;
      padding: 30px;
      position: relative;
      z-index: 1; /* ç”»åƒã®ä¸‹ã«é…ç½® */
    }
    

  </style>  
</head>
<body>
  <div id="main-title">
    YouTubeã®é–²è¦§å±¥æ­´ã‹ã‚‰<br>ã‚ãªãŸã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«ã«æ°—ä»˜ã“ã†
  </div>
  
  <div id="instruction">
    <p>
      <strong>ğŸ”´å§‹ã‚ã‚‹å‰ã«ï¼š</strong>
      <a href="https://takeout.google.com/" target="_blank" style="color: #6e7dff; text-decoration: underline;">
        https://takeout.google.com/
      </a>
      ã‹ã‚‰YouTubeã®é–²è¦§å±¥æ­´ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚
    </p>
  </div>
  <h1>ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚‚ã†</h1>
  <button id="load-file">Load ZIP File</button>
  
  <div id="container">
    <img id="bubble-animation" src="assets/images/bubble1.png" alt="Bubble Image">
    <div id="pie-chart">Loading...</div>
  </div>
  
  <footer style="background-color: #333; color: white; padding: 20px; text-align: center; font-size: 19px; line-height: 1.5;">
    <p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®YouTubeã®è¦–è´å±¥æ­´ã‚’åŸºã«ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’åˆ†æã—ã€<br>ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«(ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®åã‚Š)ã«æ°—ã¥ãã€å•é¡Œè§£æ±ºã«å½¹ç«‹ã¦ã¦ã‚‚ã‚‰ã†ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚<br>èª­ã¿è¾¼ã¾ã‚ŒãŸé–²è¦§å±¥æ­´ã®ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã€æˆ‘ã€…ã«ãã®æƒ…å ±ãŒä¸€åˆ‡å–å¾—ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã€è±Šä¸­é«˜æ ¡ æƒ…å ±5ç­ã€‘</p>
  </footer>
  
</body>
<script>
const MAX_VIDEO_COUNT = 100;
const API_KEY = 'AIzaSyCI1znNIR2N-Q8HxsXwpYV76G5Jmg1mnPE'; // APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®š
const VIDEO_API_URL = 'https://www.googleapis.com/youtube/v3/videos';

const CATEGORY_ID_MAP = {
  '1': 'æ˜ ç”»ã¨ã‚¢ãƒ‹ãƒ¡',
  '2': 'è‡ªå‹•è»Šã¨ä¹—ã‚Šç‰©',
  '10': 'éŸ³æ¥½',
  '15': 'ãƒšãƒƒãƒˆã¨å‹•ç‰©',
  '17': 'ã‚¹ãƒãƒ¼ãƒ„',
  '19': 'æ—…è¡Œã¨ã‚¤ãƒ™ãƒ³ãƒˆ',
  '20': 'ã‚²ãƒ¼ãƒ ',
  '22': 'ãƒ–ãƒ­ã‚°',
  '23': 'ã‚³ãƒ¡ãƒ‡ã‚£ãƒ¼',
  '24': 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆ',
  '25': 'ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ”¿æ²»',
  '26': 'ãƒã‚¦ãƒ„ãƒ¼ã¨ã‚¹ã‚¿ã‚¤ãƒ«',
  '27': 'æ•™è‚²',
  '28': 'ç§‘å­¦ã¨æŠ€è¡“',
};
  
  document.addEventListener('DOMContentLoaded', () => {
    const images = [
      "assets/images/bubble4.png",
      "assets/images/bubble5.png",
      "assets/images/bubble6.png"
    ];
    const imageElement = document.getElementById('bubble-animation');
    let currentIndex = 0;

    // ç”»åƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–“éš” (ãƒŸãƒªç§’)
    const interval = 500; // 0.5ç§’ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆ

    // ç”»åƒã®åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯
    setInterval(() => {
      currentIndex = (currentIndex + 1) % images.length; // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å¾ªç’°
      imageElement.src = images[currentIndex]; // ç”»åƒã‚’å¤‰æ›´
    }, interval);
  });

document.addEventListener('DOMContentLoaded', () => {
  const loadFileButton = document.getElementById('load-file');
  loadFileButton.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.zip';
    input.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          const zipData = reader.result;
          processZipFile(zipData);
        };
        reader.readAsArrayBuffer(file);
      } else {
        console.log('No file selected.');
      }
    });
    input.click();
  });
});

function processZipFile(zipData) {
  JSZip.loadAsync(zipData).then(zip => {
    // ZIPå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆåŒ–ã—ã¦ãƒ‘ã‚¹ã‚’ç¢ºèª
    zip.forEach((relativePath, file) => {
      console.log(relativePath); // ZIPå†…ã®ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è¡¨ç¤º
    });

    // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãªã—ã§å…ƒã®ãƒ‘ã‚¹ã‚’ä½¿ç”¨
    const historyFilePath = "Takeout/YouTube ã¨ YouTube Music/å±¥æ­´/watch-history.json";

    // ZIPå†…ã§æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
    const historyFile = zip.file(historyFilePath);

    if (historyFile) {
      // ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€ãã®å†…å®¹ã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦èª­ã¿è¾¼ã‚€
      historyFile.async("text").then(content => {
        parseAndDisplayHistory(content);  // é–¢æ•°ã‚’ä½¿ã£ã¦å†…å®¹ã‚’å‡¦ç†
      });
    } else {
      // ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      console.error('æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒZIPå†…ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
      alert('ZIPãƒ•ã‚¡ã‚¤ãƒ«ã«watch-history.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
    }
  }).catch(error => {
    console.error('ZIPãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
  });
}


async function fetchCategoryName(categoryId) {
  return CATEGORY_ID_MAP[categoryId] || 'ä¸æ˜ãªã‚«ãƒ†ã‚´ãƒª';
}

async function fetchVideoCategory(videoId) {
  try {
    const response = await fetch(`${VIDEO_API_URL}?part=snippet&id=${videoId}&key=${API_KEY}`);
    if (!response.ok) {
      throw new Error(`HTTPã‚¨ãƒ©ãƒ¼ï¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}`);
    }
    const data = await response.json();
    if (data.items && data.items.length > 0) {
      const categoryId = data.items[0].snippet.categoryId;
      return await fetchCategoryName(categoryId);
    }
    return 'ä¸æ˜ãªã‚«ãƒ†ã‚´ãƒª';
  } catch (error) {
    console.error('YouTube APIã®ã‚¨ãƒ©ãƒ¼:', error);
    return 'ä¸æ˜ãªã‚«ãƒ†ã‚´ãƒª';
  }
}

async function parseAndDisplayHistory(jsonText) {
  try {
    const history = JSON.parse(jsonText);
    if (!Array.isArray(history)) {
      throw new Error('ç„¡åŠ¹ãªJSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ');
    }

    const categoryCount = {};

    // ã“ã“ã§æœ€å¤§ MAX_VIDEO_COUNT ä»¶ã®å±¥æ­´ã‚’å–å¾—
    const videoUrls = history
      .filter(entry => entry.titleUrl && entry.titleUrl.startsWith('https://www.youtube.com/watch?v='))
      .slice(0, MAX_VIDEO_COUNT);

    for (const entry of videoUrls) {
      const videoId = new URL(entry.titleUrl).searchParams.get('v');
      if (videoId) {
        const categoryName = await fetchVideoCategory(videoId);
        categoryCount[categoryName] = (categoryCount[categoryName] || 0) + 1;
      }
    }

    drawPieChart(categoryCount);

  } catch (error) {
    console.error('å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®è§£æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
    const pieChartContainer = document.getElementById('pie-chart');
    pieChartContainer.innerHTML = `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`;
  }
}
const CATEGORY_IMAGES = {
  'æ˜ ç”»ã¨ã‚¢ãƒ‹ãƒ¡': 'category1.png',
  'è‡ªè»¢è»Šã¨ä¹—ã‚Šç‰©': 'category2.png',
  'éŸ³æ¥½': 'category3.png',
  'ãƒšãƒƒãƒˆã¨å‹•ç‰©': 'category4.png',
  'ã‚¹ãƒãƒ¼ãƒ„': 'category5.png',
  'æ—…è¡Œã¨ã‚¤ãƒ™ãƒ³ãƒˆ': 'category6.png',
  'ã‚²ãƒ¼ãƒ ': 'category7.png',
  'ãƒ–ãƒ­ã‚°': 'category8.png',
  'ã‚³ãƒ¡ãƒ‡ã‚£ãƒ¼': 'category9.png',
  'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆ': 'category10.png',
  'ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ”¿æ²»': 'category11.png',
  'ãƒã‚¦ãƒ„ãƒ¼ã¨ã‚¹ã‚¿ã‚¤ãƒ«': 'category12.png',
  'æ•™è‚²': 'category13.png',
  'ç§‘å­¦ã¨æŠ€è¡“': 'category14.png',
};

function drawPieChart(categoryCount) {
  google.charts.load('current', { packages: ['corechart'] });
  google.charts.setOnLoadCallback(() => {
    const data = new google.visualization.DataTable();
    data.addColumn('string', 'ã‚«ãƒ†ã‚´ãƒª');
    data.addColumn('number', 'æ•°');

    for (const [category, count] of Object.entries(categoryCount)) {
      data.addRow([category, count]);
    }

    const options = {
      title: 'ã‚ãªãŸã®è¦‹ã¦ã„ã‚‹å‹•ç”»ã‚«ãƒ†ã‚´ãƒªã®åã‚Šã¯ï¼Ÿ',
      pieHole: 0.4,
      legend: { position: 'bottom' },
    };

    const chart = new google.visualization.PieChart(document.getElementById('pie-chart'));
    chart.draw(data, options);

    // å††ã‚°ãƒ©ãƒ•ãŒæç”»ã•ã‚ŒãŸå¾Œã«ç”»åƒã‚’è¡¨ç¤º
    displayCategoryImages(categoryCount);
    document.getElementById('bubble-animation').style.display = 'block';
    document.getElementById('pie-chart').style.display = 'block'; // å††ã‚°ãƒ©ãƒ•ã®è¡¨ç¤ºã‚’ç¢ºå®Ÿã«ã™ã‚‹
  });
}
  
  function displayCategoryImages(categoryCount) {
  const sortedCategories = Object.entries(categoryCount)
    .sort((a, b) => b[1] - a[1]) // é«˜ã„é †ã«ä¸¦ã¹æ›¿ãˆ
    .map(([category, count]) => ({ category, count }));

  // ä¸Šä½3ã¤ã®ã‚«ãƒ†ã‚´ãƒªã‚’å–å¾—
  const topCategories = sortedCategories.slice(0, 3);

  // ä¸Šä½3ã¤ã«åŠ ãˆã¦5ä½ã€6ä½ã€7ä½ã€8ä½ã‚’å–å¾—ï¼ˆè¶³ã‚Šãªã„å ´åˆã¯undefinedã‚’å›é¿ï¼‰
  const selectedCategories = [
    topCategories[0], // 1ä½
    topCategories[1], // 2ä½
    topCategories[2], // 3ä½
    sortedCategories[4] || {}, // 5ä½
    sortedCategories[5] || {}, // 6ä½
    sortedCategories[6] || {}, // 7ä½
    sortedCategories[7] || {}, // 8ä½
  ];
    
 const imageContainer = document.createElement('div');
  imageContainer.id = 'image-container'; // ä¿®æ­£ã•ã‚ŒãŸCSSãŒé©ç”¨ã•ã‚Œã‚‹
  imageContainer.style.position = 'absolute'; // å¿…è¦ãªã‚‰æ‰‹å‹•ã§è¿½åŠ 

    selectedCategories.forEach(({ category = '' }, index) => {
    // categoryãŒç©ºã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
    if (!category) return;
      
    const imagePath = `assets/images/${CATEGORY_IMAGES[category]}`;
    const img = document.createElement('img');
    img.src = imagePath;
    img.alt = category;
    img.style.width = '150px';
    img.style.height = 'auto';
    img.style.margin = '10px';
    img.style.borderRadius = '10px';
      
// é †ä½ã«å¿œã˜ã¦ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸
images.forEach((image, index) => {
  const img = document.createElement('img');
  img.src = image.src;
  img.className = `category-image rank-${index + 1}`; // 1, 2, 3 ã¨é †ä½ã«å¿œã˜ãŸã‚¯ãƒ©ã‚¹ã‚’è¨­å®š
  imageContainer.appendChild(img);
});
      
  const container = document.getElementById('container');
  container.appendChild(imageContainer);
}
  
</script>
</html>
