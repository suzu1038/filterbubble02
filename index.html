<!DOCTYPE html>
<html lang="ja">
  <head>
  <meta charset="UTF-8">
  <title>あなたのYouTubeの閲覧履歴からフィルターバブルを実感しよう</title>
　 <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru&display=swap" rel="stylesheet">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/kuromoji/0.1.3/kuromoji.min.js"></script>

  <style>
    body {
     font-family: 'Kiwi Maru', serif; 
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start; /* 上部にコンテンツを寄せる */
      height: auto; /* 高さを自動調整 */
      background-color: #F0F2FF; /* 背景色を #F0F2FF に設定 */
      color: #000; /* 文字色を黒に設定 */
      overflow: auto; /* スクロールを有効にする */
      position: relative;
      padding-top: 50px; /* 上部に余白を追加 */
      letter-spacing: 2px;
    }
  
  
#main-title {
  position: relative;
  padding: 1rem .5rem;
  font-size: 43px; /* 必要に応じて調整 */
  font-weight: bold;
  color: #000; /* 文字色を黒に設定 */
  background-color: #6ADDED; /* 背景色を #6ABBC6 に設定 */
  padding: 25px; /* 余白を大きく */
  border-radius: 10px; /* 角を丸く */
  width: 50%; /* タイトルの幅を調整 */
  text-align: center; /* 中央揃え */
  margin-bottom: 40px; /* タイトルとボタンの間に余白を追加 */
  line-height: 1.5; /* 行間を調整して2行に見やすくする */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  border: 2px solid #000;
}
#main-title:after {
  position: absolute;
  bottom: 0px; /* タイトルの下に配置 */
  left: 0;
  width: 100%;
  height: 10px; /* 下線の太さ */
  content: '';
  border-radius: 3px;
  background-image: -webkit-gradient(linear, right top, left top, from(#2af598), to(#009efd));
  background-image: -webkit-linear-gradient(right, #2af598 0%, #009efd 100%);
  background-image: linear-gradient(to left, #2af598 0%, #009efd 100%);
    border-top: 2px solid #000;
  background-image: -webkit-repeating-linear-gradient(135deg, #000, #000 1px, transparent 2px, transparent 5px);
  background-image: repeating-linear-gradient(-45deg, #000, #000 1px, transparent 2px, transparent 5px);
  background-size: 7px 7px;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* 固定ボタンのデザイン */
.sticky-buttons {
  position: fixed;
  top: 0;
  left: 0;
  display: flex;
  flex-direction: row; /* 横一列に並べる */
  z-index: 1000;
  width: 100%; /* 全幅に広げる */
  background-color: #f8f9fa; /* 背景色 */
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 下に影を付ける */
  padding: 10px 0; /* 縦方向の余白 */
}

.sticky-buttons button {
  flex: 1; /* ボタンを等間隔に広げる */
  color: white;
  font-size: 1rem;
  padding: 10px 20px;
  border: none;
  cursor: pointer;
  border-radius: 0; /* ボタンの角をフラットに */
  transition: background-color 0.3s ease;
}

.sticky-buttons button:hover {
  opacity: 0.7; /* ボタンをホバーしたときに少し暗くする */
}

/* ボタンごとの色を指定 */
.sticky-buttons .button1 {
  background-color: #de1b27; /* 赤色 */
}

.sticky-buttons .button2 {
  background-color: #bb5da9; /* サーモン色 */
}

.sticky-buttons .button3 {
  background-color: #207bcb; /* 水色 */
}

.sticky-buttons .button4 {
  background-color: #20cb49; /* ライトグリーン */
}

    
  .headline  h2 {
  position: relative;
  overflow: hidden;
  background-color: #6ADDED;
    width: 600px;
  padding: 1.5rem 2rem 1.5rem 130px;
  border: 2px solid #000;
}

.headline h2:before {
  position: absolute;
  top: -150%;
  left: -100px;
  width: 240px;
  height: 300%;
  content: '';
  -webkit-transform: rotate(25deg);
  transform: rotate(25deg);
  background: #000;
}

.headline h2 span {
  font-size: 40px;
  font-size: 4rem;
  position: absolute;
  z-index: 1;
  top: 0;
  left: 0;
  display: block;
  padding-top: 3px;
  padding-left: 16px;
  color: #fff;
}
    
    .content-box {
  background-color: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  max-width: 800px;
  margin: 20px auto;
}

.content-box h2 {
  font-size: 1.5em;
  margin-bottom: 45px;
  margin-top: 40px; 
  text-align: center;
   position: relative;
   padding: 1.5rem;
}

.content-box h2:before {
  position: absolute;
  bottom: -10px;
  left: calc(50% - 30px);
  width: 60px;
  height: 5px;
  content: '';
  border-radius: 3px;
  background: #F1454B;
}

.content-box h2:after {
  position: absolute;
  content: '';
}


.content-box h2:after {
  top: 0;
  left: 0;
  width: 40px;
  height: 40px;
  border-top: 2px solid #000;
  border-left: 2px solid #000;
}

.content-box p {
  line-height: 1.6;
  font-size: 1.3em;
  margin-bottom: 10px;
}
    
.highlight {
  font-weight: bold;
  color: red;
}

.littlehighlight {
  font-weight: bold;
  font-size: 1.35em;
}


    .content-box2 {
  border-radius: 10px;
  padding: 20px;
  max-width: 700px;
  margin: 20px auto;
}

.content-box2 h2 {
  font-size: 1.5em;
  margin-top: 20px; /* 見出しの上にスペースを追加 */
  margin-bottom: 10px;
}

.content-box2 p {
  line-height: 1.6;
  font-size: 1.3em;
  margin-bottom: 10px;
}

.content-box2 a {
  display: inline-block;
  margin-bottom: 17px;
  color: #007BFF; /* リンクの色 */
  text-decoration: none;
  font-weight: bold;
}

.content-box2 a:hover {
  text-decoration: underline;
}

.content-box2 img {
  max-width: 100%; /* レスポンシブ対応 */
  height: auto;
  margin: 10px 0;
  border-radius: 5px;
}
    
    #instruction {
    font-size: 30px; /* 元の16pxから1.5倍 */
    font-weight: bold;
    color: #000; /* 文字色を黒に設定 */
    background-color: #FFFFFF;
    padding: 15px; /* 元の15pxから1.5倍 */
    border-radius: 15px; /* 元の10pxから1.5倍 */
    border: 4.5px solid #6e7dff; /* 元の2pxから1.5倍 */
    text-align: center;
    margin: 30px 0; /* 元の20pxから1.5倍 */
    line-height: 2.25; /* 元の1.5から1.5倍 */
    width: 100%;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* 元の影を1.5倍 */
  }

    /* ボタンのスタイル */
    h1 {
      font-size: 30px;
      color: #000; /* 文字色を黒に設定 */
      margin-bottom: 45px; /* タイトルとボタンの間に大きな余白 */
    }
  
    #load-file {
      padding: 15px 30px;
      font-size: 24px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      background-color: #6e7dff;
      border: none;
      color: #fff; /* ボタン内の文字色は白のまま */
      border-radius: 7.5px;
      margin-bottom: 45px; /* ボタンと画像の間に余白を追加 */
    }
  
    #load-file:hover {
      background-color: #4d5bc5;
    }
  
    #container {
      width: 90%;
      max-width: 800px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative; 
    }

    #bubble-animation-container {
  position: relative;  /* 親要素を基準に位置指定を可能にする */
  width: 700px;  /* 親要素の幅を100%に設定 */
  height: 700px; /* 親要素の高さを100%に設定（必要に応じて調整） */
  display: flex;  /* 中の要素を柔軟に配置できるようにする */
  justify-content: center;  /* 子要素を水平方向に中央配置 */
  align-items: center;  /* 子要素を垂直方向に中央配置 */
}
    
#bubble-animation {
  position: absolute; 
  width: 700px; 
  height: auto;
  margin-bottom: 40px; 
  display: none; /* 必要に応じてblockに変更 */
  position: relative; /* bubble-animationにもpositionを設定 */
  z-index: 1; /* bubble-animationはz-index: 1 */
}


@keyframes floatUpDown {
  0% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-5px); /* 上にふわっと */
  }
  100% {
    transform: translateY(0);
  }
}

.floating {
  animation: floatUpDown 2s ease-in-out infinite;
}


    
    /* 円グラフのスタイル */
    #pie-chart {
      width: 800px;
      height: 800px;
      border: 3px solid #ddd;
      border-radius: 15px;
      background-color: #f9f9f9;
      padding: 30px;
      position: relative;
      z-index: 1; /* 画像の下に配置 */
    }

   
/* スマホ用スタイル */
@media screen and (max-width: 1300px) {
  body {
    font-size: calc(1.1 * 16px); /* 元の基本フォントサイズを1.3倍 */
  }

  #main-title,
  #instruction,
   #pie-chart{
   width: calc(1.5 * 60%); /* 元の幅を1.5倍 */
   }

   .sticky-buttons button {
    padding: 30px 0; /* ボタンの縦幅と横幅を広げる */
    font-size: 1.2rem; /* フォントサイズも調整 */
  }
  
    .content-box {
    max-width: 85%; /* スマホ用の最大幅 */
    padding: 24px; 
  }
    .content-box2 {
    max-width: 85%; /* スマホ用の最大幅 */
    padding: 24px; 
  }
  .headline  h2 {
    max-width: 90%;
}

  #load-file {
    font-size: calc(1.3 * 24px); /* ボタン文字サイズ */
    padding: calc(1.5 * 15px) calc(1.5 * 30px); /* ボタンのパディング */
  }


  #bubble-animation,
  #top-images img {
    width: calc(1.3 * 700px); /* Bubble Animationの幅を1.3倍 */
  }
}

  </style>  
</head>
<body>
<div class="sticky-buttons">
  <button class="button1" onclick="scrollToSection('headline1')">はじめに</button>
  <button class="button2" onclick="scrollToSection('headline2')">使い方</button>
  <button class="button3" onclick="scrollToSection('headline3')">やってみる</button>
  <button class="button4" onclick="scrollToSection('headline4')">アンケート</button>
</div>
  <div id="main-title">
    YouTubeの閲覧履歴から<br>あなたのフィルターバブルに気付こう
  </div>

   <div id="headline1" class="headline">
<h2><span>01</span>　　　はじめに</h2>
  </div>
  
  <div class="content-box">
  <h2>あなたのYouTube、偏った動画ばかりではありませんか？</h2>
  <p>YouTubeを利用するとき、<br>
「いつも同じジャンルの動画ばかりがおすすめされる」<br>
そう感じたことはありませんか？<br><br>
YouTubeのアルゴリズムは、あなたの過去の視聴履歴や検索履歴から、<br>
<span class="highlight">「あなたが見たいと思う動画」を予測して</span>表示しています。<br><br>

これは便利な反面、まるで好きな食べ物をいつも頼むレストランで、<br>
新しいメニューを勧められないような状態になるのです。</p>

  <h2>フィルターバブルとは？</h2>
  <p>
このような現象を「フィルターバブル」と呼びます。<br>
フィルターバブルの問題点は、以下の通りです：<br><br>

・ <span class="highlight">多様な意見や新しい視点に触れる機会を奪う</span><br>
・ 偏った情報に囲まれてしまう<br><br>
YouTubeのおすすめ機能はとても便利なものですが、<br>
同時に知らない世界への扉を閉ざしてしまう可能性も秘めています。</p>

  <h2>このサイトで「バブル」を破ろう！</h2>
  <p>そこで、本サイトを活用することで、<br>
あなたが「どんなジャンルが好きか」<br>
「どんなジャンルにあまり興味がないか」<br>
という自身の趣味嗜好を一目で理解できるでしょう。

</p>

  <h2>「フィルターバブル」を破るメリット</h2>
  <p>これをきっかけに新しいジャンルの動画を見てみると、<br>
    次第にあなたの「バブル」は割れていくでしょう。<br><br>
    見聞を広めることは、あなたの生活を豊かにする肥料になります。<br><br>
    <span class="littlehighlight">ぜひ自身のYouTubeのフィルターバブルに気付くことで、<br>
    毎日新しい出会いに溢れる人生の種を育んでみてください。</span>


</p>
</div>

     <div id="headline2" class="headline">
<h2><span>02</span>　　　このサイトの使い方</h2>
  </div>
<div class="content-box2">
  <h2>① まずは下準備に閲覧履歴のDLをしましょう。</h2>
  <p>以下にDL方法の説明を載せています。<br>
    手順は同じですが、やりやすいように案内方法をわけています。必ず案内に従ってDLしてください。<br>
    ・ <a href="instructions.html" target="_blank" rel="noopener noreferrer">文字で読む方はこちら</a></p>
  <p>・スマホからで動画で説明を見る方はこちら</p>
  <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000;">
  <iframe 
    src="https://www.youtube.com/embed/FQl38eAM7p4" 
    frameborder="0" 
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
    allowfullscreen 
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
  </iframe>
</div>
   <p>・PCからで動画で説明を見る方はこちら</p>
  <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000;">
  <iframe 
    src="https://www.youtube.com/embed/UDGWy6ytCxc" 
    frameborder="0" 
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
    allowfullscreen 
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
  </iframe>
</div>
    <div id="instruction">
    <p>
      <a href="https://takeout.google.com/" target="_blank" style="color: #6e7dff; text-decoration: underline;">
        https://takeout.google.com/
      </a>
      からYouTubeの閲覧履歴のデータをダウンロードできます。
    </p>
  </div>

  <h2>② ここではジャンルのことをカテゴリーといいます。</h2>
  <p>これはYouTube公式の定めた区分に沿った分け方です。<br>
  全部で14のカテゴリーがあります。<br>
  履歴におけるこれらのカテゴリーの偏りを分析していきます。</p>
  <img src="assets/images/category_parts.png" alt="カテゴリーの説明画像" />

  <h2>③ステップ03で実際に読み込んだ際の画像の見方です。</h2>
  <img src="assets/images/explain_bubble.png" alt="バブルの説明画像" />
</div>

       <div id="headline3" class="headline">
<h2><span>03</span>　　　いよいよ実際にやってみよう！</h2>
  </div>

  <h1>下のボタンを押してZIPファイルを読み込もう<br>
  （読み込んでから10秒ほどかかります）</h1>
  <button id="load-file">Load ZIP File</button>
  
  <div id="container">
    <div id="bubble-animation-container">
    <img id="bubble-animation" src="assets/images/bubble1.png" alt="Bubble Image">
  </div>
    <div id="pie-chart">Loading...</div>
  </div>
  <div>
  <h2>カテゴリランキング（上位10件）</h2>
  <ul id="category-list">
    <!-- カテゴリランキング結果がここに表示されます -->
  </ul>
    </div>
  <div>
  <h2>名詞ランキング（上位10件）</h2>
  <ul id="ranking-list">
    <!-- ランキング結果がここに表示されます -->
  </ul>
</div>
         <div id="headline4" class="headline">
<h2><span>04</span>　　　アンケート協力のお願い</h2>
  </div>
  <div class="content-box2">
      <p> <span class="littlehighlight">ステップ03まで終えた方は以下のURLからアンケートのご協力お願いします。<br>
        2,3分程で終わります。<br><br>
 <a href="https://forms.gle/VrU4ZjNekLTQPWYi8" target="_blank" style="color: #6e7dff; text-decoration: underline;">
        https://forms.gle/VrU4ZjNekLTQPWYi8
      </a><br>
       ここまでありがとうございました。<br>
          少しでもあなたの興味が広がりますように！</span>
        </p>
      </div>
  <footer style="background-color: #333; color: white; padding: 20px; text-align: center; font-size: 19px; line-height: 1.5;">
    <p>本サービスでは、ユーザーのYouTubeの視聴履歴を基にカテゴリーを分析し、<br>ユーザー自身がフィルターバブル(カテゴリーの偏り)に気づき、問題解決に役立ててもらうことを目的としています。<br>読み込まれた閲覧履歴のデータについて、我々にその情報が一切取得されることはありません。<br>【豊中高校 情報5班】</p>
  </footer>
  
</body>
<script>
const MAX_VIDEO_COUNT = 100;
const API_KEY = 'AIzaSyCI1znNIR2N-Q8HxsXwpYV76G5Jmg1mnPE'; // APIキーをここに設定
const VIDEO_API_URL = 'https://www.googleapis.com/youtube/v3/videos';

const CATEGORY_ID_MAP = {
  '1': '映画とアニメ',
  '2': '自動車と乗り物',
  '10': '音楽',
  '15': 'ペットと動物',
  '17': 'スポーツ',
  '19': '旅行とイベント',
  '20': 'ゲーム',
  '22': 'ブログ',
  '23': 'コメディー',
  '24': 'エンターテイメント',
  '25': 'ニュースと政治',
  '26': 'ハウツーとスタイル',
  '27': '教育',
  '28': '科学と技術',
};
  
  document.addEventListener('DOMContentLoaded', () => {
    const images = [
      "assets/images/bubble4.png",
      "assets/images/bubble5.png",
      "assets/images/bubble6.png"
    ];
    const imageElement = document.getElementById('bubble-animation');
  const bubbleAnimationContainer = document.getElementById('bubble-animation-container'); // 親要素
    let currentIndex = 0;

    // 画像を切り替える間隔 (ミリ秒)
    const interval = 500; // 0.5秒ごとに切り替え

    // 画像の切り替えロジック
    setInterval(() => {
      currentIndex = (currentIndex + 1) % images.length; // インデックスを循環
      imageElement.src = images[currentIndex]; // 画像を変更
    }, interval);
  });

document.addEventListener('DOMContentLoaded', () => {
  const loadFileButton = document.getElementById('load-file');
  loadFileButton.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.zip';
    input.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          const zipData = reader.result;
          processZipFile(zipData);
        };
        reader.readAsArrayBuffer(file);
      } else {
        console.log('No file selected.');
      }
    });
    input.click();
  });
});

function processZipFile(zipData) {
  JSZip.loadAsync(zipData).then(zip => {
    // ZIP内のファイルをリスト化してパスを確認
    zip.forEach((relativePath, file) => {
      console.log(relativePath); // ZIP内のすべてのファイルパスを表示
    });

    // エンコードなしで元のパスを使用
    const historyFilePath = "Takeout/YouTube と YouTube Music/履歴/watch-history.json";

    // ZIP内で指定したファイルを検索
    const historyFile = zip.file(historyFilePath);

    if (historyFile) {
      // ファイルが見つかった場合、その内容をテキストとして読み込む
      historyFile.async("text").then(content => {
        parseAndDisplayHistory(content);  // 関数を使って内容を処理
      });
    } else {
      // ファイルが見つからなかった場合のエラーハンドリング
      console.error('指定されたファイルがZIP内に見つかりませんでした。');
      alert('ZIPファイルにwatch-history.jsonが見つかりません。');
    }
  }).catch(error => {
    console.error('ZIPファイルの読み込みエラー:', error);
  });
}


async function fetchCategoryName(categoryId) {
  return CATEGORY_ID_MAP[categoryId] || '不明なカテゴリ';
}

async function fetchVideoCategory(videoId) {
  try {
    const response = await fetch(`${VIDEO_API_URL}?part=snippet&id=${videoId}&key=${API_KEY}`);
    if (!response.ok) {
      throw new Error(`HTTPエラー！ステータス: ${response.status}`);
    }
    const data = await response.json();
    if (data.items && data.items.length > 0) {
      const categoryId = data.items[0].snippet.categoryId;
      return await fetchCategoryName(categoryId);
    }
    return '不明なカテゴリ';
  } catch (error) {
    console.error('YouTube APIのエラー:', error);
    return '不明なカテゴリ';
  }
}

async function parseAndDisplayHistory(jsonText) {
  try {
    const history = JSON.parse(jsonText);
    if (!Array.isArray(history)) {
      throw new Error('無効なJSONフォーマット');
    }

    const categoryCount = {};
     const videoTitles = [];

    // ここで最大 MAX_VIDEO_COUNT 件の履歴を取得
    const videoUrls = history
      .filter(entry => entry.titleUrl && entry.titleUrl.startsWith('https://www.youtube.com/watch?v='))
      .slice(0, MAX_VIDEO_COUNT);

    for (const entry of videoUrls) {
      const videoId = new URL(entry.titleUrl).searchParams.get('v');
      if (videoId) {
        const categoryName = await fetchVideoCategory(videoId);
        categoryCount[categoryName] = (categoryCount[categoryName] || 0) + 1;

         const title = await fetchVideoTitle(videoId);
        videoTitles.push(title);
      }
    }

    drawPieChart(categoryCount);

  } catch (error) {
    console.error('履歴データの解析中にエラーが発生しました:', error);
    const pieChartContainer = document.getElementById('pie-chart');
    pieChartContainer.innerHTML = `エラーが発生しました: ${error.message}`;
  }
}
const CATEGORY_IMAGES = {
  '映画とアニメ': 'category1.png',
  '自転車と乗り物': 'category2.png',
  '音楽': 'category3.png',
  'ペットと動物': 'category4.png',
  'スポーツ': 'category5.png',
  '旅行とイベント': 'category6.png',
  'ゲーム': 'category7.png',
  'ブログ': 'category8.png',
  'コメディー': 'category9.png',
  'エンターテイメント': 'category10.png',
  'ニュースと政治': 'category11.png',
  'ハウツーとスタイル': 'category12.png',
  '教育': 'category13.png',
  '科学と技術': 'category14.png',
};

function drawPieChart(categoryCount) {
  google.charts.load('current', { packages: ['corechart'] });
  google.charts.setOnLoadCallback(() => {
    const data = new google.visualization.DataTable();
    data.addColumn('string', 'カテゴリ');
    data.addColumn('number', '数');

    for (const [category, count] of Object.entries(categoryCount)) {
      data.addRow([category, count]);
    }

    const options = {
      title: 'あなたの見ている動画カテゴリの偏りは？',
      pieHole: 0.4,
      legend: { position: 'bottom' },
    };

    const chart = new google.visualization.PieChart(document.getElementById('pie-chart'));
    chart.draw(data, options);

    // 円グラフが描画された後に画像を表示
    displayCategoryImages(categoryCount);
    document.getElementById('bubble-animation').style.display = 'block';
    document.getElementById('pie-chart').style.display = 'block'; // 円グラフの表示を確実にする
  });
}

function displayCategoryImages(categoryCount) {
  const sortedCategories = Object.entries(categoryCount).sort((a, b) => b[1] - a[1]);

   const topImagesContainer = document.createElement('div');
  topImagesContainer.style.position = 'absolute';
  topImagesContainer.style.display = 'flex';
  topImagesContainer.style.justifyContent = 'center';
  topImagesContainer.style.alignItems = 'center';
  topImagesContainer.style.zIndex = '2';

  // スマホかどうかを判定
  const isMobile = window.innerWidth <= 1300;

  if (isMobile) {
    // スマホの場合の位置設定
    topImagesContainer.style.top = '30%';
    topImagesContainer.style.left = '38%';
    topImagesContainer.style.transform = 'translate(0%, 0%)';
  } else {
    // デスクトップの場合の位置設定
    topImagesContainer.style.top = '38%';
    topImagesContainer.style.left = '38%';
    topImagesContainer.style.transform = 'translate(0%, 0%)';
  }
  

    const positions = isMobile
    ? [
        { top: '120px', left: '-50px' },
        { top: '-120px', left: '0px' },
        { top: '40px', left: '100px' },
      ]
    : [
        { top: '100px', left: '-90px' },
        { top: '-170px', left: '0px' },
        { top: '20px', left: '130px' },
      ];

  const squarePositions = isMobile
    ? [
        { top: '-250px', left: '-250px' },
        { top: '-250px', left: '250px' },
        { top: '350px', left: '-250px' },
        { top: '350px', left: '250px' },
      ]
    : [
        { top: '-210px', left: '-230px' },
        { top: '-210px', left: '230px' },
        { top: '250px', left: '-220px' },
        { top: '250px', left: '220px' },
      ];

  sortedCategories.slice(0, 3).forEach(([category, count], index) => {
    const imgElement = document.createElement('img');
    imgElement.src = `assets/images/${CATEGORY_IMAGES[category]}`;
    imgElement.alt = `${category}の画像`;
    imgElement.style.position = 'absolute';
    imgElement.style.top = positions[index].top;
    imgElement.style.left = positions[index].left;
    imgElement.style.width = '140px';
    imgElement.style.height = 'auto';
    imgElement.style.margin = '0 15px';
    imgElement.title = `${category} (${count}件)`;

    // ランダムな遅延を追加
    const randomDelay = Math.random() * 2;  // 0〜2秒のランダムな遅延
    imgElement.style.animationDelay = `${randomDelay}s`;
    imgElement.classList.add('floating');  // CSSアニメーションのクラスを追加

    topImagesContainer.appendChild(imgElement);
  });

  sortedCategories.slice(4, 8).forEach(([category, count], index) => {
    const imgElement = document.createElement('img');
    imgElement.src = `assets/images/${CATEGORY_IMAGES[category]}`;
    imgElement.alt = `${category}の画像`;
    imgElement.style.position = 'absolute';
    imgElement.style.top = squarePositions[index].top;
    imgElement.style.left = squarePositions[index].left;
    imgElement.style.width = '140px';
    imgElement.style.height = 'auto';
    imgElement.style.margin = '0 15px';
    imgElement.title = `${category} (${count}件)`;

    // ランダムな遅延を追加
    const randomDelay = Math.random() * 2;  // 0〜2秒のランダムな遅延
    imgElement.style.animationDelay = `${randomDelay}s`;
    imgElement.classList.add('floating');  // CSSアニメーションのクラスを追加

    topImagesContainer.appendChild(imgElement);
  });

    const bubbleAnimationContainer = document.getElementById('bubble-animation-container');
  if (bubbleAnimationContainer) {
    bubbleAnimationContainer.appendChild(topImagesContainer); // 親要素に追加
  }
}


 // 指定したIDの要素にスクロール
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    window.scrollTo({
      top: element.offsetTop - 50, // 調整用の余白
      behavior: 'smooth' // スムーズにスクロール
    });
  }
}

  kuromoji.builder({ dicPath: '/path/to/dictionary' }).build(function (err, tokenizer) {
      if (err) {
        console.error('Tokenizerのエラー:', err);
        return;
      }

      const wordFreq = {};
      videoTitles.forEach(function (title) {
        const tokens = tokenizer.tokenize(title);
        tokens.forEach(function (token) {
          // 名詞の中で「一般名詞」「固有名詞」「サ変接続名詞」のみを集計
          if (token.pos === '名詞' && 
              (token.pos_detail_1 === '一般' || 
               token.pos_detail_1 === '固有名詞' || 
               token.pos_detail_1 === 'サ変接続名詞')) {
            if (wordFreq[token.surface_form]) {
              wordFreq[token.surface_form]++;
            } else {
              wordFreq[token.surface_form] = 1;
            }
          }
        });
      });

      // 名詞頻度のランキング表示
      displayRanking(wordFreq);
    });

    // カテゴリの集計結果を表示（オプション）
    displayCategoryRanking(categoryCount);

  } catch (error) {
    console.error('履歴解析エラー:', error);
  }
}

// カテゴリ別ランキングを表示する関数
function displayCategoryRanking(categoryCount) {
  const sortedCategories = Object.entries(categoryCount)
    .sort((a, b) => b[1] - a[1]) // 頻度順にソート
    .slice(0, 10); // 上位10件を表示

  const categoryList = document.getElementById('category-list');
  categoryList.innerHTML = ''; // 既存の内容をクリア

  sortedCategories.forEach(function ([category, freq], index) {
    const listItem = document.createElement('li');
    listItem.textContent = `${index + 1}. ${category}: ${freq}回`; // ランキング形式で表示
    categoryList.appendChild(listItem); // リストに追加
  });
}

// 動画IDから動画タイトルを取得する関数
async function fetchVideoTitle(videoId) {
  try {
    const response = await fetch(`${VIDEO_API_URL}?part=snippet&id=${videoId}&key=${API_KEY}`);
    if (!response.ok) {
      throw new Error(`HTTPエラー！ステータス: ${response.status}`);
    }
    const data = await response.json();
    if (data.items && data.items.length > 0) {
      return data.items[0].snippet.title;  // タイトルを返す
    }
    return 'タイトルなし';
  } catch (error) {
    console.error('YouTube APIのエラー:', error);
    return 'タイトルなし';
  }
}

// 名詞ランキングを表示する関数
function displayRanking(wordFreq) {
  const sortedWords = Object.entries(wordFreq)
    .sort((a, b) => b[1] - a[1]) // 頻度順にソート
    .slice(0, 10); // 上位10件を表示

  const rankingList = document.getElementById('ranking-list');
  rankingList.innerHTML = ''; // 既存の内容をクリア

  sortedWords.forEach(function ([word, freq], index) {
    const listItem = document.createElement('li');
    listItem.textContent = `${index + 1}. ${word}: ${freq}回`; // ランキング形式で表示
    rankingList.appendChild(listItem); // リストに追加
  });
}


  
</script>
</html>


